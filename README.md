# ReScore

Use features calculated from comparing experimental spectra with computationally generated spectra (see [MS2PIP](https://github.com/sdgroeve/ms2pip_c)) to re-score peptide identifications using [Percolator](https://github.com/percolator/percolator/).

## Prerequisites

- Python 3

  - numpy
  - pandas
  - scikit-learn
  - scipy

- [Percolator](https://github.com/percolator/percolator/) (to run the file generated by this pipeline)

### Installing

Clone this repository. This includes the submodule  [MS2PIP](https://github.com/anasilviacs/ms2pip_c/tree/6f037dc2d0797cd25061aaed8091d625123971e1). To include this submodule, you must clone this repository using the `--recurse-submodules` flag:
```
git clone --recurse-submodules git://github.com/anasilviacs/rescore.git
```

Go into the folder `ms2pip_c` and run the bash script `compile.sh`. For more details, please refer to the `ms2pip_c` repository.

## Usage

To run the entire pipeline from the beginning, you need a spectrum file in the [MGF format](http://www.matrixscience.com/help/data_file_help.html) and a peptide list in the [PEPREC format](https://github.com/anasilviacs/ms2pip_c/tree/6f037dc2d0797cd25061aaed8091d625123971e1).

Run the pipeline as follows:

```
python driver.py <mgf file> <peprec file> <config file>
```

- `<mgf file>` is the spectrum file
- `<peprec file>` is the peptide list file
- `<config file>` is json with configurations for MS2PIP. A reference file that can be adapted is included in this repository.


### Output

Several intermediate files are created when the entire pipeline is ran. Their names are all built from the `<mgf file>` name and are stored in that file's folder. They are the following:

- `<mgf file>_pred_and_emp.csv` is one of the outputs of MS2PIP that includes the predicted and empirical intensity for each peak;
- `<mgf file>_correlations.csv` is the other MS2PIP output and includes the Pearson correlations between the predicted and empirical spectra;
- `<mgf file>_all_features.csv` includes all the spectral features that were calculated;
- `<mgf file>.pin` is a Percolator INput file that includes the calculated features.

`Percolator` can be ran on this file by typing:

```
percolator <pin file>
```

For more details regarding how to run Percolator please refer to its [wiki pages](https://github.com/percolator/percolator/wiki).
